<!DOCTYPE html>
<meta charset="utf-8">
<head>
	<title>Trip Analyzer</title>
	<link rel="stylesheet" href="./css/style.css">
	<link rel="stylesheet" href="./css/jquery-ui.css">	
	<link rel="stylesheet" type="text/css" href="./css/zInput_default_stylesheet.css">
</head>
<body>
	<script src="./js/import/d3.v3.min.js"></script> 
	<script src="./js/import/topojson.v1.min.js"></script>  
	<script src="./js/import/datamaps.world.min.js?v=1"></script>
	<script src="./js/import/jquery-1.12.4.js"></script>
	<script src="./js/import/jquery-ui.js"></script>				
	<script src="./js/import/zInput.js"></script>			
	
	<div id="inputDialog" title="- Tell us more about the trip -">			
		<form>
			<fieldset style="height:280px;">
			
				<div>
					<label for="name" class="form-label">Budget</label>				
					<ul id="selectBudget" class="select-box">
						<li class="ui-widget-content" id="budget-low">Low</li>
						<li class="ui-widget-content" id="budget-mid">Mid</li>
						<li class="ui-widget-content" id="budget-high">High</li>
					</ol>
				</div>
				
				<div>
					<label for="name" class="form-label">Density</label>				
					<ul id="selectDensity" class="select-box">
						<li class="ui-widget-content" id="density-low">Low</li>
						<li class="ui-widget-content" id="density-mid">Mid</li>
						<li class="ui-widget-content" id="density-high">High</li>
					</ol>
				</div>
				
				<div>
					<label for="name" class="form-label">Trip Duration</label>				
					<input style="margin-left:50px;" type="text" id="tripDuartion" value="" >				
				</div>
								
				<div id="selectCategory">					
					<input type="checkbox" name="check[]" title="discovering">
					<input type="checkbox" name="check[]" title="eating">
					<input type="checkbox" name="check[]" title="nightlife">
					<input type="checkbox" name="check[]" title="outdoors">
					<input type="checkbox" name="check[]" title="family">
					<input type="checkbox" name="check[]" title="relaxing">
					<input type="checkbox" name="check[]" title="shopping">
					<input type="checkbox" name="check[]" title="sightseeing">
					<input type="checkbox" name="check[]" title="sports">					
				</div>
								
				
				<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
			</fieldset>
		</form>
	</div>
	
	<div id="divMain" style="text-align: center;" class="transparent">
		<div style="display: inline-block;">
			<div id="divContainer">
				<div id="divInput" class="main-div">
					user input: <input type="text" name="name" id="name" value="">				
				</div>	
				<div id="divMap" class="main-div"></div>
				<div id="divBottom" class="main-div">chart</div>
				<div id="divRight" class="main-div">top 20 accordions</div>
			</div>			
			<footer>&copy; Copyright 2019 Trip Analyzer</footer>
		</div>
	<div>

	
	<script src="./js/userInput.js"></script>	      
		  	 
	<script>		
	
		
	
		$( function() {			
			// initialize
			$("#selectBudget").selectable();
			$("#selectDensity").selectable();						
			$("#selectCategory").zInput();							
		});  													
		
				
	</script>
	
	
	
	<script> 
		
		var bubbleArray = [];
		var cities;
		
		$.get("./include/connect_db.php", function(data){
			getAllCities(data); 	


			//console.log(document.getElementById("name").value);
			 			
			generateTop20Ranking();
			
			// todo: add more filtering steps here
			// eg, reddit
			// eg, sygic 
			// --- end of todo ---

			sortByScore();
			addBubbles();
		});
		
		// fetch all data from database
		function getAllCities(data)
		{
			cities  = JSON.parse(data);
			// default score at 0
			for(i=0; i<cities.length; i++){				
				cities[i]["score"] = 0;	
				cities[i].rank = parseInt(cities[i].rank);		// type conversion	
				cities[i].lat = parseFloat(cities[i].lat);		// type conversion	
				cities[i].lng = parseFloat(cities[i].lng);		// type conversion	
			}						
		}		
		
		// testing function: simple default ranking from top 100 cities 
		function generateTop20Ranking(){						
			for (i = 0; i < 20; i++){
				var bubble = { name: cities[i].city, latitude: cities[i].lat, longitude: cities[i].lng, radius: 44-i*2, fillKey: 'colorBlue'+i};
				bubbleArray.push(bubble);								
			};									
		}
		
		// sort cities by score then default rank from top 100
		function sortByScore(){			
			cities.sort(function(a,b){				
				if (a.score > b.score)	{	return -1;	}
				else if (a.score < b.score)	{	return 1;	}
				else {
					if (a.rank < b.rank)	{	return -1;	}
					else if (a.rank > b.rank)	{	return 1;	}
				}													
			});						
		}					
		
	</script>		
	
	<script src="./js/dataMap.js"></script>			
			
	
</body>

